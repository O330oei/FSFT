From b0f01ecf293c49d841abbf8b55c4b717936ab11e Mon Sep 17 00:00:00 2001
From: Guoqing Jiang <jgq516@gmail.com>
Date: Tue, 3 Sep 2019 11:41:03 +0200
Subject: [PATCH] md/raid5: use bio_end_sector to calculate last_sector
Git-commit: b0f01ecf293c49d841abbf8b55c4b717936ab11e
Patch-mainline: v5.4-rc1
References: bsc#1166003

Use the common way to get last_sector.

Signed-off-by: Guoqing Jiang <guoqing.jiang@cloud.ionos.com>
Signed-off-by: Song Liu <songliubraving@fb.com>
Signed-off-by: Coly Li <colyli@suse.de>

---
 drivers/md/raid5.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/drivers/md/raid5.c b/drivers/md/raid5.c
index 88e56ee98976..da6a86e28318 100644
--- a/drivers/md/raid5.c
+++ b/drivers/md/raid5.c
@@ -5499,7 +5499,7 @@ static void make_discard_request(struct mddev *mddev, struct bio *bi)
 		return;
 
 	logical_sector = bi->bi_iter.bi_sector & ~((sector_t)STRIPE_SECTORS-1);
-	last_sector = bi->bi_iter.bi_sector + (bi->bi_iter.bi_size>>9);
+	last_sector = bio_end_sector(bi);
 
 	bi->bi_next = NULL;
 
-- 
2.25.0

